# M2 里程碑目标：参数校验 + 友好 CLI 信息

## 1. 里程碑目标
在 M2 完成两件事：  
1) 参数校验与错误提示闭环；  
2) 提供用户友好的 `clap` 交互信息（无参执行、`-h`、`-v` 等）。  
对应 `QRGen.md` 中里程碑建议：  
`M2: 补齐参数校验与错误提示`。

## 2. 范围（In Scope）
- 输入内容校验：仅包含空白字符时判定为非法输入并报错。
- 尺寸参数校验：`--size` 必须大于 `0`，非法值报错。
- 输出路径校验：当指定 `-o/--output` 且父目录不存在时，直接报错并中止。
- 错误信息规范化：错误信息同时包含“原因 + 建议动作”。
- 失败路径退出码：所有上述错误路径都以非 `0` 退出。
- `clap` 友好信息：
  - `qrgen` 直接执行时展示帮助和示例（避免只看到生硬错误）。
  - `qrgen -h/--help` 输出清晰的命令说明、参数说明、示例。
  - `qrgen -v/--version` 输出版本信息，文案简洁。

## 3. 非范围（Out of Scope）
以下内容不作为 M2 完成条件：
- 新输出格式能力（如 SVG）。
- UI/渲染效果优化。
- README 示例与发布流程完善（归属后续里程碑）。

## 4. 规划设计（CLI 友好性）
- 命令帮助结构：
  - 标题：一句话说明 `qrgen` 用途。
  - `Usage`：展示基础调用模式。
  - `Arguments`：说明 `<CONTENT>` 的含义。
  - `Options`：至少包含 `-o/--output`、`-s/--size`、`-h/--help`、`-v/--version`。
  - `Examples`：提供 3 条可直接复制执行的示例。
- 无参执行策略：
  - 执行 `qrgen` 时优先展示帮助与示例，引导用户下一步怎么做。
- 错误提示策略：
  - 参数错误时保留具体原因，并给出建议动作（例如“请传入非空文本”）。

## 5. 当前实现状态（已完成）
- 空输入校验：在业务入口对 `content.trim()` 做空值判断，报错  
  `input content is empty. Please provide non-empty text.`
- 尺寸校验：对 `size == 0` 直接拒绝，报错  
  `invalid --size value: must be greater than 0.`
- 目录校验：`--output` 指向路径的父目录不存在时拒绝写入，报错  
  `output directory does not exist: <DIR>. Please create it first.`
- 写文件失败透传：PNG 写入失败时带路径上下文返回错误信息。
- 统一退出行为：`main` 捕获错误后输出 `Error: ...` 并 `exit(1)`。
- `clap` 友好交互已实现：
  - `qrgen` 无参执行直接展示帮助与示例。
  - `qrgen -h/--help` 返回结构化帮助与示例。
  - `qrgen -v/--version` 返回版本信息（如 `qrgen 0.1.0`）。
  - 无参显示帮助场景退出码为 `0`，便于用户与脚本处理。

## 6. 验收标准（M2 DoD）
满足以下条件即可判定 M2 完成：
1. 执行 `cargo run -- "   "`，返回非 `0`，并提示输入为空。
2. 执行 `cargo run -- "hello" --size 0`，返回非 `0`，并提示尺寸非法。
3. 执行 `cargo run -- "hello" -o ./not-exist/qr.png`（目录不存在），返回非 `0`，并提示目录不存在及处理建议。
4. 错误场景由 `main` 统一打印错误并设置非 `0` 退出码。
5. 执行 `cargo run --`（无参数）可看到包含示例的帮助信息。
6. 执行 `cargo run -- -h` 返回结构化帮助（Usage/Arguments/Options/Examples）。
7. 执行 `cargo run -- -v` 或 `cargo run -- --version` 返回版本信息，退出码为 `0`。

## 7. 交付物
- 参数校验逻辑（空输入、尺寸、输出目录）已接入主流程。
- 统一错误输出与退出码策略已接入 CLI 入口。
- 失败路径自动化测试覆盖已补齐（见 `tests/run_failure.rs` 中对应失败用例）。
- `clap` 交互增强（无参帮助、`-h`、`-v/--version`、示例文案）实现与测试。

## 8. 实施清单（建议）
1. 在 `cli` 定义中补充帮助文案与示例模板。
2. 配置无参执行时显示帮助（含示例）。
3. 统一版本参数行为，确保 `-v/--version` 输出一致。
4. 增加/更新测试：无参、`-h`、`-v`、错误文案。
