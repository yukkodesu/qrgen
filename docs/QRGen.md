# QRGen CLI 需求与实现目标

## 1. 项目目标
实现一个简单、可用、可发布的命令行工具 `qrgen`，用于将输入文本生成二维码图片。

核心目标：
- 用户可在终端一条命令生成二维码。
- 默认行为简单（零配置可用）。
- 错误提示明确，便于定位问题。
- 代码结构支持后续扩展（如 SVG、终端预览、批量生成）。

## 2. 目标用户与使用场景
目标用户：
- 需要快速生成二维码的开发者/运营人员。
- 希望通过脚本自动化生成二维码的用户。

典型场景：
- 将 URL 生成二维码用于分享。
- 将任意文本（如 Wi-Fi 信息、联系方式）生成二维码图片。
- 在 CI 或脚本中批量调用。

## 3. MVP 功能范围（第一版必须实现）
### 3.1 输入
- 支持通过位置参数传入二维码内容（字符串）。
- 输入为空时返回错误并给出用法提示。

### 3.2 输出行为
- 支持通过参数指定输出文件路径（例如 `-o`/`--output`）。
- 当未指定 `-o` 时，默认在 terminal 中以 TUI 方式渲染二维码。
- 当指定 `-o` 时，输出 PNG 文件到目标路径。
- 若输出目录不存在，返回明确错误。

### 3.3 渲染与格式
- MVP 支持两种输出形式：
  - Terminal TUI 渲染（默认）
  - PNG 文件输出（指定 `-o` 时）
- 成功时输出内容可被常见扫码工具识别。

### 3.4 尺寸与基础配置
- 支持设置图片尺寸（如 `--size`，默认 `256`）。
- 尺寸必须为正整数，非法值报错。

### 3.5 命令帮助
- 支持 `-h`/`--help` 展示用法。
- 支持 `-V`/`--version` 展示版本。

## 4. CLI 交互设计
建议命令形式：

```bash
qrgen "https://example.com"
```

可选参数（MVP）：
- `-o, --output <FILE>`: 输出 PNG 文件路径；不传时默认走 terminal TUI 渲染
- `-s, --size <PIXELS>`: 输出尺寸（像素），默认 `256`
- `-h, --help`: 查看帮助
- `-V, --version`: 查看版本

示例：

```bash
qrgen "hello world"
qrgen "https://example.com" -o ./dist/site.png
qrgen "WIFI:T:WPA;S:MyWiFi;P:12345678;;" --size 512
```

## 5. 非功能需求
- 可移植性：支持 macOS/Linux 基本运行。
- 性能：单次生成在常规机器上应为“瞬时完成”（< 1s）。
- 可维护性：核心逻辑与 CLI 参数解析分离。
- 可测试性：关键分支具备基础自动化测试。

## 6. 错误处理要求
出现以下问题时，需返回非 0 退出码并打印清晰错误信息：
- 输入内容为空。
- 尺寸参数非法（非数字、<= 0）。
- 输出路径不可写。
- 文件写入失败。

错误信息应包含：
- 错误原因（发生了什么）。
- 建议动作（用户下一步该怎么做）。

## 7. 验收标准（Definition of Done）
满足以下条件即可认为 MVP 完成：
1. `cargo run -- "https://example.com"` 在 terminal 中渲染二维码（未指定 `-o`）。
2. `-o` 可指定输出 PNG 路径，且文件存在。
3. `--size` 可影响输出尺寸，非法值会报错并退出码非 0。
4. `--help` / `--version` 可正常工作。
5. 至少覆盖 3 类测试：
   - 参数解析测试
   - 生成成功路径测试
   - 非法输入失败测试

## 8. 实现建议（Rust）
建议依赖方向：
- CLI 解析：`clap`
- 二维码生成：`qrcode`
- 图片输出：`image`
- 终端渲染：`ratatui`（或简化方案如 ANSI block 渲染）
- 错误处理：`anyhow` 或 `thiserror`

建议模块划分：
- `main.rs`: 参数解析与流程编排
- `qr.rs`（或 `lib.rs` 内模块）: 生成二维码与写文件逻辑

## 9. 暂不纳入 MVP（后续迭代）
- SVG 输出
- 终端 ASCII/Unicode 预览
- 颜色定制（前景/背景）
- 纠错级别可配置（L/M/Q/H）
- Logo 嵌入
- 批量输入（文件/CSV）

## 10. 里程碑建议
- M1: 跑通基础命令与默认 TUI 渲染（并支持 `-o` 输出 PNG）
- M2: 补齐参数校验与错误提示
- M3: 增加测试与 README 使用示例
- M4: 规划并实现第一个扩展特性（如 SVG 输出）
